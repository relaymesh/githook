Metadata-Version: 2.1
Name: relaymesh-githook
Version: 0.0.7
Summary: Relaymesh Githook worker SDK
Home-page: UNKNOWN
License: UNKNOWN
Platform: UNKNOWN
Requires-Python: >=3.9
Description-Content-Type: text/markdown
Provides-Extra: amqp
Provides-Extra: kafka
Provides-Extra: nats
Provides-Extra: all

# Relaymesh Githook Python Worker SDK

The Python worker SDK mirrors the Go/TypeScript worker interfaces and connects to the Githook control plane for rules, drivers, event logs, and SCM credentials.

## Install

```bash
pip install relaymesh-githook
```

Install the relaybus adapter you need:

```bash
pip install relaybus-amqp
pip install relaybus-kafka
pip install relaybus-nats
```

## Quick Start

```python
import signal
import threading

from relaymesh_githook import New, NewRemoteSCMClientProvider, WithClientProvider, WithEndpoint

stop = threading.Event()

def shutdown(_signum, _frame):
    stop.set()

signal.signal(signal.SIGINT, shutdown)
signal.signal(signal.SIGTERM, shutdown)

wk = New(
    WithEndpoint("http://localhost:8080"),
    WithClientProvider(NewRemoteSCMClientProvider()),
)

def handle(ctx, evt):
    installation_id = evt.metadata.get("installation_id", "")
    print(f"topic={evt.topic} provider={evt.provider} type={evt.type} installation={installation_id}")
    if evt.payload:
        print(f"payload bytes={len(evt.payload)}")

wk.HandleRule("85101e9f-3bcf-4ed0-b561-750c270ef6c3", handle)

wk.Run(stop)
```

## Handler Signature

Handlers can accept either `(event)` or `(ctx, event)`:

```python
def handle(evt):
    print(evt.provider, evt.type)

def handle_with_ctx(ctx, evt):
    print(ctx.request_id, evt.topic)
```

## Using SCM Clients

```python
from relaymesh_githook import GitHubClient

def handler(ctx, evt):
    gh = GitHubClient(evt)
    if gh:
        user = gh.request_json("GET", "/user")
        print(user.get("login"))
```

## Environment Variables

The worker will read defaults from:

- `GITHOOK_ENDPOINT` or `GITHOOK_API_BASE_URL`
- `GITHOOK_API_KEY`
- `GITHOOK_TENANT_ID`


